<!DOCTYPE html>
<html lang="en" x-data="app()" x-init="initLang(); initAuth()">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Register | Avarwand</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Poppins', 'sans-serif'],
            fa: ['B Nazanin', 'sans-serif'],
            faTitle: ['B Titr', 'sans-serif'],
          },
          colors: {
            primary: '#7C3AED',
            accent: '#EC4899',
            dark: '#0F0F1A',
            card: '#1A1A2E',
          },
        }
      }
    }
  </script>

  <!-- Alpine.js -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

  <!-- CryptoJS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

  <!-- Auth JS -->
  <script src="auth.js"></script>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/b-nazanin@1.0.0/css/b-nazanin.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/b-titr@1.0.0/css/b-titr.min.css" rel="stylesheet">

  <style>
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: #0F0F1A; }
    ::-webkit-scrollbar-thumb { background: linear-gradient(#7C3AED, #EC4899); border-radius: 3px; }
    html { scroll-behavior: smooth; }
    .glass { background: rgba(26, 26, 46, 0.7); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(124, 58, 237, 0.2); }
    [x-cloak] { display: none !important; }
    .fa-title { line-height: 1.15; padding-top: 0.75rem; padding-bottom: 0.75rem; }
    footer { direction: ltr !important; text-align: center !important; font-family: 'Poppins', sans-serif !important; font-size: 0.875rem; }
    .navbar-brand { @apply text-white font-bold text-7xl; }
    .navbar-brand.fa { font-family: 'B Titr', sans-serif !important; }
  </style>
</head>
<body class="bg-dark text-gray-100 min-h-screen" :class="lang === 'fa' ? 'font-fa' : 'font-sans'">

  <!-- Language Selector -->
  <div x-data="{ open: false }" class="fixed top-4 left-4 z-50">
    <button @click="open = !open" class="glass p-1 rounded-full shadow-xl flex items-center gap-1 transition-all hover:scale-110">
      <img :src="flag(lang)" alt="Flag" class="w-5 h-5 rounded-full">
      <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
      </svg>
    </button>
    <div x-show="open" @click.outside="open = false" class="absolute left-0 mt-2 w-40 glass rounded-xl shadow-2xl py-2 overflow-hidden text-sm">
      <button @click="setLang('en'); open = false" class="flex items-center gap-2 px-3 py-2 hover:bg-primary/20 w-full text-left">
        <img src="https://flagcdn.com/us.svg" class="w-4 h-4 rounded-full"> English
      </button>
      <button @click="setLang('fa'); open = false" class="flex items-center gap-2 px-3 py-2 hover:bg-primary/20 w-full text-left">
        <img src="https://flagcdn.com/ir.svg" class="w-4 h-4 rounded-full"> Persian
      </button>
      <button @click="setLang('de'); open = false" class="flex items-center gap-2 px-3 py-2 hover:bg-primary/20 w-full text-left">
        <img src="https://flagcdn.com/de.svg" class="w-4 h-4 rounded-full"> Deutsch
      </button>
    </div>
  </div>

  <!-- Navbar -->
  <nav x-data="{ open: false, scrolled: false }" 
       @scroll.window="scrolled = window.scrollY > 50"
       :class="scrolled ? 'bg-dark/90 glass shadow-2xl' : 'bg-transparent'"
       class="fixed top-0 w-full z-40 transition-all duration-500">
    <div class="container mx-auto px-6 py-5 flex justify-between items-center">
      <a :href="'index.html?lang=' + lang" :class="lang === 'fa' ? 'navbar-brand fa' : 'navbar-brand'" x-text="brand()"></a>
      <ul class="hidden md:flex space-x-8 items-center" :class="lang === 'fa' ? 'space-x-reverse' : ''">
        <li><a :href="'index.html?lang=' + lang" class="hover:text-primary transition font-medium" x-text="t('nav.home')"></a></li>
        <li><a :href="'index.html?lang=' + lang + '#products'" class="hover:text-primary transition font-medium" x-text="t('nav.products')"></a></li>
        <li><a :href="'index.html?lang=' + lang + '#about'" class="hover:text-primary transition font-medium" x-text="t('nav.about')"></a></li>
        <li><a :href="'index.html?lang=' + lang + '#contact'" class="hover:text-primary transition font-medium" x-text="t('nav.contact')"></a></li>
        <li><a :href="'terms.html?lang=' + lang" class="hover:text-primary transition font-medium" x-text="t('nav.terms')"></a></li>

		<!-- در بخش دسکتاپ -->
		<template x-if="!isLoggedIn">
		  <div class="flex items-center gap-4">
			<li><a :href="'register.html?lang=' + lang" class="hover:text-primary transition font-medium" x-text="t('nav.register')"></a></li>
			<li><a :href="'login.html?lang=' + lang" class="bg-primary hover:bg-primary/80 px-4 py-2 rounded-full text-white transition" x-text="t('nav.login')"></a></li>
		  </div>
		</template>

		<template x-if="isLoggedIn">
		  <li class="flex items-center gap-3">
			<span class="text-sm text-gray-300" x-text="currentUser?.name || currentUser?.email.split('@')[0]"></span>
			<button @click="handleLogout()" class="bg-red-500 hover:bg-red-600 px-3 py-1.5 rounded text-white text-sm transition" x-text="t('nav.logout')"></button>
			<a :href="'shop.html?lang=' + lang" class="bg-gradient-to-r from-accent to-primary hover:from-primary hover:to-accent px-4 py-2 rounded-full text-white text-sm transition" x-text="t('nav.shop')"></a>
		  </li>
		</template>
      </ul>
      <button @click="open = !open" class="md:hidden text-2xl">Menu</button>
    </div>
    <div x-show="open" class="md:hidden glass mx-4 mt-2 rounded-xl shadow-2xl" x-cloak>
      <ul class="py-4 text-right" :class="lang === 'fa' ? 'text-right' : 'text-left'">
        <li><a :href="'index.html?lang=' + lang" class="block px-6 py-3 hover:bg-primary/20" x-text="t('nav.home')"></a></li>
        <li><a :href="'index.html?lang=' + lang + '#products'" class="block px-6 py-3 hover:bg-primary/20" x-text="t('nav.products')"></a></li>
        <li><a :href="'index.html?lang=' + lang + '#about'" class="block px-6 py-3 hover:bg-primary/20" x-text="t('nav.about')"></a></li>
        <li><a :href="'index.html?lang=' + lang + '#contact'" class="block px-6 py-3 hover:bg-primary/20" x-text="t('nav.contact')"></a></li>
        <li><a :href="'terms.html?lang=' + lang" class="block px-6 py-3 hover:bg-primary/20" x-text="t('nav.terms')"></a></li>
        <template x-if="!isLoggedIn">
          <li><a :href="'register.html?lang=' + lang" class="block px-6 py-3 hover:bg-primary/20" x-text="t('nav.register')"></a></li>
          <li><a :href="'login.html?lang=' + lang" class="block px-6 py-3 bg-primary/20" x-text="t('nav.login')"></a></li>
        </template>
        <template x-if="isLoggedIn">
          <li class="px-6 py-3 flex items-center justify-between">
            <span x-text="currentUser?.name || currentUser?.email"></span>
            <button @click="handleLogout()" class="text-red-400" x-text="t('nav.logout')"></button>
          </li>
          <li><a :href="'shop.html?lang=' + lang" class="block px-6 py-3 bg-gradient-to-r from-accent to-primary text-white rounded-xl text-center" x-text="t('nav.shop')"></a></li>
        </template>
      </ul>
    </div>
  </nav>

  <!-- Register Form -->
  <section class="min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-900 via-pink-800 to-red-900 py-20">
    <div class="container mx-auto px-6">
      <div class="max-w-md mx-auto glass p-8 rounded-3xl shadow-2xl">
        <h1 :class="lang === 'fa' ? 'font-faTitle text-3xl fa-title text-center mb-6' : 'text-3xl text-center mb-6 font-bold text-white'"
            x-text="t('register.title')"></h1>
        <form @submit.prevent="handleRegister" class="space-y-4">
          <div>
            <label class="block text-sm font-medium mb-2" x-text="t('register.name')"></label>
            <input type="text" x-model="form.name" class="w-full p-3 rounded-xl bg-card text-white placeholder-gray-400" :placeholder="t('register.name_placeholder')">
          </div>
          <div>
            <label class="block text-sm font-medium mb-2" x-text="t('register.email')"></label>
            <input type="email" x-model="form.email" required class="w-full p-3 rounded-xl bg-card text-white placeholder-gray-400" :placeholder="t('register.email_placeholder')">
          </div>
          <div>
            <label class="block text-sm font-medium mb-2" x-text="t('register.password')"></label>
            <input type="password" x-model="form.password" required minlength="6" class="w-full p-3 rounded-xl bg-card text-white placeholder-gray-400" :placeholder="t('register.password_placeholder')">
          </div>
          <button type="submit" class="w-full py-3 bg-gradient-to-r from-primary to-accent text-white font-bold rounded-xl hover:scale-105 transition" :disabled="loading">
            <span x-show="!loading" x-text="t('register.button')"></span>
            <span x-show="loading" x-text="t('register.loading')"></span>
          </button>
          <p x-show="message" :class="success ? 'text-green-400' : 'text-red-400'" x-text="message" class="text-center mt-2"></p>
        </form>
        <p class="text-center mt-4 text-gray-400">
          <span x-text="t('register.haveAccount')"></span>
          <a :href="'login.html?lang=' + lang" class="text-primary hover:underline" x-text="t('register.loginLink')"></a>
        </p>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="bg-card/50 py-6 sm:py-8 text-sm border-t border-primary/10">
    © 2025 Avarwand. All rights reserved.
  </footer>

  <!-- Alpine Logic -->
  <script>
    function app() {
      return {
        lang: 'en',
        isLoggedIn: false,
        currentUser: null,
        form: { name: '', email: '', password: '' },
        message: '',
        loading: false,
        success: false,

        translations: {
          en: {
            brand: 'Avarwand',
            'nav.home': 'Home', 'nav.products': 'Products', 'nav.about': 'About', 'nav.contact': 'Contact', 'nav.terms': 'Terms of Use',
            'nav.register': 'Register', 'nav.login': 'Login', 'nav.logout': 'Logout', 'nav.shop': 'Shop',
            'register.title': 'Create Account',
            'register.name': 'Name (Optional)', 'register.name_placeholder': 'Your Name',
            'register.email': 'Email', 'register.email_placeholder': 'example@email.com',
            'register.password': 'Password (min 6 chars)', 'register.password_placeholder': '••••••',
            'register.button': 'Register', 'register.loading': 'Registering...',
            'register.haveAccount': 'Already have an account?', 'register.loginLink': 'Login here'
          },
          fa: {
            brand: 'اوروند',
            'nav.home': 'خانه', 'nav.products': 'محصولات', 'nav.about': 'درباره', 'nav.contact': 'تماس', 'nav.terms': 'قوانین استفاده',
            'nav.register': 'ثبت‌نام', 'nav.login': 'ورود', 'nav.logout': 'خروج', 'nav.shop': 'خرید',
            'register.title': 'ایجاد حساب',
            'register.name': 'نام (اختیاری)', 'register.name_placeholder': 'نام شما',
            'register.email': 'ایمیل', 'register.email_placeholder': 'example@email.com',
            'register.password': 'رمز عبور (حداقل ۶ کاراکتر)', 'register.password_placeholder': '••••••',
            'register.button': 'ثبت‌نام', 'register.loading': 'در حال ثبت‌نام...',
            'register.haveAccount': 'حساب دارید؟', 'register.loginLink': 'اینجا وارد شوید'
          },
          de: {
            brand: 'Avarwand',
            'nav.home': 'Start', 'nav.products': 'Produkte', 'nav.about': 'Über uns', 'nav.contact': 'Kontakt', 'nav.terms': 'Nutzungsbedingungen',
            'nav.register': 'Registrieren', 'nav.login': 'Einloggen', 'nav.logout': 'Ausloggen', 'nav.shop': 'Einkaufen',
            'register.title': 'Konto erstellen',
            'register.name': 'Name (Optional)', 'register.name_placeholder': 'Ihr Name',
            'register.email': 'E-Mail', 'register.email_placeholder': 'example@email.com',
            'register.password': 'Passwort (mind. 6 Zeichen)', 'register.password_placeholder': '••••••',
            'register.button': 'Registrieren', 'register.loading': 'Wird registriert...',
            'register.haveAccount': 'Haben Sie ein Konto?', 'register.loginLink': 'Hier einloggen'
          }
        },

        t(key) { return this.translations[this.lang][key] || key; },
        brand() { return this.translations[this.lang].brand; },
        flag(lang) { return lang === 'fa' ? 'https://flagcdn.com/ir.svg' : lang === 'de' ? 'https://flagcdn.com/de.svg' : 'https://flagcdn.com/us.svg'; },

        setLang(newLang) {
          this.lang = newLang;
          localStorage.setItem('lang', newLang);
          document.documentElement.lang = newLang;
          document.documentElement.dir = newLang === 'fa' ? 'rtl' : 'ltr';
        },

        initLang() {
          const urlParams = new URLSearchParams(window.location.search);
          const urlLang = urlParams.get('lang');
          if (urlLang && ['en', 'fa', 'de'].includes(urlLang)) {
            this.setLang(urlLang);
          } else {
            const saved = localStorage.getItem('lang');
            this.setLang(saved || 'en');
          }
        },

		initAuth() {
		  // اگر کاربر قبلاً لاگین کرده، به صفحه اصلی هدایت شود
		  if (Auth.isLoggedIn()) {
			window.location.href = `index.html?lang=${this.lang}`;
			return;
		  }
		  
		  const authStatus = Auth.checkAuthStatus();
		  this.isLoggedIn = authStatus.isLoggedIn;
		  this.currentUser = authStatus.currentUser;
		},
		
		isLoggedIn: false,
		  currentUser: null,
		  initAuth() {
			if (typeof Auth !== 'undefined' && Auth.isLoggedIn()) {
			  this.isLoggedIn = true;
			  this.currentUser = Auth.getCurrentUser();
			} else {
			  this.isLoggedIn = false;
			  this.currentUser = null;
			}
		  },

		  handleLogout() {
			if (typeof Auth !== 'undefined') Auth.logout();
			this.isLoggedIn = false;
			this.currentUser = null;
			window.location.href = `index.html?lang=${this.lang}`;
		  },


        handleLogout() {
          if (typeof Auth !== 'undefined') Auth.logout();
          this.isLoggedIn = false;
          this.currentUser = null;
          window.location.href = `index.html?lang=${this.lang}`;
        },

        async handleRegister() {
          this.loading = true;
          this.message = '';
          const result = await Auth.register(this.form.email, this.form.password, this.form.name);
          this.success = result.success;
          this.message = result.message;
          if (result.success) {
            this.form = { name: '', email: '', password: '' };
            setTimeout(() => window.location.href = `login.html?lang=${this.lang}`, 1500);
          }
          this.loading = false;
        }
      };
    }
  </script>
</body>
</html>