<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Login | Avarwand</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Poppins', 'sans-serif'],
            fa: ['B Nazanin', 'sans-serif'],
            faTitle: ['B Titr', 'sans-serif'],
          },
          colors: {
            primary: '#7C3AED',
            accent: '#EC4899',
            dark: '#0F0F1A',
            card: '#1A1A2E',
          },
        }
      }
    }
  </script>

  <!-- CryptoJS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

  <!-- Auth System -->
  <script src="auth.js"></script>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/b-nazanin@1.0.0/css/b-nazanin.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/b-titr@1.0.0/css/b-titr.min.css" rel="stylesheet">

  <style>
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: #0F0F1A; }
    ::-webkit-scrollbar-thumb { background: linear-gradient(#7C3AED, #EC4899); border-radius: 3px; }
    html { scroll-behavior: smooth; }
    .glass { background: rgba(26, 26, 46, 0.7); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(124, 58, 237, 0.2); }
    [x-cloak] { display: none !important; }
    .fa-title { line-height: 1.15; padding-top: 0.75rem; padding-bottom: 0.75rem; }
    footer { direction: ltr !important; text-align: center !important; font-family: 'Poppins', sans-serif !important; font-size: 0.875rem; }
    .navbar-brand { @apply text-white font-bold text-7xl; }
    .navbar-brand.fa { font-family: 'B Titr', sans-serif !important; }
  </style>

  <!-- Alpine Logic -->
  <script>
    function app() {
      return {
        lang: 'en',
        isLoggedIn: false,
        currentUser: null,
        form: { email: '', password: '' },
        message: '',
        loading: false,
        success: false,

        translations: {
          en: {
            brand: 'Avarwand',
            'nav.home': 'Home', 'nav.products': 'Products', 'nav.about': 'About', 'nav.contact': 'Contact', 'nav.terms': 'Terms of Use',
            'nav.register': 'Register', 'nav.login': 'Login', 'nav.logout': 'Logout', 'nav.shop': 'Shop',
            'login.title': 'Login',
            'login.email': 'Email', 'login.email_placeholder': 'example@email.com',
            'login.password': 'Password', 'login.password_placeholder': '••••••',
            'login.button': 'Login', 'login.loading': 'Logging in...',
            'login.noAccount': "Don't have an account?", 'login.registerLink': 'Register here'
          },
          fa: {
            brand: 'اوروند',
            'nav.home': 'خانه', 'nav.products': 'محصولات', 'nav.about': 'درباره', 'nav.contact': 'تماس', 'nav.terms': 'قوانین استفاده',
            'nav.register': 'ثبت‌نام', 'nav.login': 'ورود', 'nav.logout': 'خروج', 'nav.shop': 'خرید',
            'login.title': 'ورود',
            'login.email': 'ایمیل', 'login.email_placeholder': 'example@email.com',
            'login.password': 'رمز عبور', 'login.password_placeholder': '••••••',
            'login.button': 'ورود', 'login.loading': 'در حال ورود...',
            'login.noAccount': 'حساب ندارید؟', 'login.registerLink': 'ثبت‌نام کنید'
          },
          de: {
            brand: 'Avarwand',
            'nav.home': 'Start', 'nav.products': 'Produkte', 'nav.about': 'Über uns', 'nav.contact': 'Kontakt', 'nav.terms': 'Nutzungsbedingungen',
            'nav.register': 'Registrieren', 'nav.login': 'Einloggen', 'nav.logout': 'Ausloggen', 'nav.shop': 'Einkaufen',
            'login.title': 'Einloggen',
            'login.email': 'E-Mail', 'login.email_placeholder': 'example@email.com',
            'login.password': 'Passwort', 'login.password_placeholder': '••••••',
            'login.button': 'Einloggen', 'login.loading': 'Wird eingeloggt...',
            'login.noAccount': 'Kein Konto?', 'login.registerLink': 'Hier registrieren'
          }
        },

        t(key) { return this.translations[this.lang][key] || key; },
        brand() { return this.translations[this.lang].brand; },
        flag(lang) { return lang === 'fa' ? 'https://flagcdn.com/ir.svg' : lang === 'de' ? 'https://flagcdn.com/de.svg' : 'https://flagcdn.com/us.svg'; },

        setLang(newLang) {
          this.lang = newLang;
          localStorage.setItem('lang', newLang);
          document.documentElement.lang = newLang;
          document.documentElement.dir = newLang === 'fa' ? 'rtl' : 'ltr';
        },

        initLang() {
          const urlParams = new URLSearchParams(window.location.search);
          const urlLang = urlParams.get('lang');
          if (urlLang && ['en', 'fa', 'de'].includes(urlLang)) {
            this.setLang(urlLang);
          } else {
            const saved = localStorage.getItem('lang');
            this.setLang(saved || 'en');
          }
        },

        initAuth() {
          if (Auth.isLoggedIn()) {
            window.location.href = `index.html?lang=${this.lang}`;
            return;
          }
          
          const authStatus = Auth.checkAuthStatus();
          this.isLoggedIn = authStatus.isLoggedIn;
          this.currentUser = authStatus.currentUser;
        },

        handleLogout() {
          if (typeof Auth !== 'undefined') Auth.logout();
          this.isLoggedIn = false;
          this.currentUser = null;
          window.location.href = `index.html?lang=${this.lang}`;
        },

        async handleLogin() {
          this.loading = true;
          this.message = '';
          const result = await Auth.login(this.form.email, this.form.password);
          this.success = result.success;
          this.message = result.message;
          if (result.success) {
            setTimeout(() => window.location.href = `index.html?lang=${this.lang}`, 1500);
          }
          this.loading = false;
        }
      };
    }
  </script>

  <!-- Alpine.js -->
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body class="bg-dark text-gray-100 min-h-screen" :class="lang === 'fa' ? 'font-fa' : 'font-sans'" x-data="app()" x-init="initLang(); initAuth()">

  <!-- Language Selector -->
  <div x-data="{ open: false }" class="fixed top-4 left-4 z-50">
    <button @click="open = !open" class="glass p-1 rounded-full shadow-xl flex items-center gap-1 transition-all hover:scale-110">
      <img :src="flag(lang)" alt="Flag" class="w-5 h-5 rounded-full">
      <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
      </svg>
    </button>
    <div x-show="open" @click.outside="open = false" class="absolute left-0 mt-2 w-40 glass rounded-xl shadow-2xl py-2 overflow-hidden text-sm">
      <button @click="setLang('en'); open = false" class="flex items-center gap-2 px-3 py-2 hover:bg-primary/20 w-full text-left">
        <img src="https://flagcdn.com/us.svg" class="w-4 h-4 rounded-full"> English
      </button>
      <button @click="setLang('fa'); open = false" class="flex items-center gap-2 px-3 py-2 hover:bg-primary/20 w-full text-left">
        <img src="https://flagcdn.com/ir.svg" class="w-4 h-4 rounded-full"> Persian
      </button>
      <button @click="setLang('de'); open = false" class="flex items-center gap-2 px-3 py-2 hover:bg-primary/20 w-full text-left">
        <img src="https://flagcdn.com/de.svg" class="w-4 h-4 rounded-full"> Deutsch
      </button>
    </div>
  </div>

  <!-- Navbar -->
  <nav x-data="{ open: false, scrolled: false }" 
       @scroll.window="scrolled = window.scrollY > 50"
       :class="scrolled ? 'bg-dark/90 glass shadow-2xl' : 'bg-transparent'"
       class="fixed top-0 w-full z-40 transition-all duration-500">
    <div class="container mx-auto px-6 py-5 flex justify-between items-center">
      <a :href="'index.html?lang=' + lang" :class="lang === 'fa' ? 'navbar-brand fa' : 'navbar-brand'" x-text="brand()"></a>
      <ul class="hidden md:flex space-x-8 items-center ml-auto" :class="lang === 'fa' ? 'space-x-reverse mr-auto' : ''">
        <li><a :href="'index.html?lang=' + lang" class="hover:text-primary transition font-medium" x-text="t('nav.home')"></a></li>
        <li><a :href="'index.html?lang=' + lang + '#products'" class="hover:text-primary transition font-medium" x-text="t('nav.products')"></a></li>
        <li><a :href="'index.html?lang=' + lang + '#about'" class="hover:text-primary transition font-medium" x-text="t('nav.about')"></a></li>
        <li><a :href="'index.html?lang=' + lang + '#contact'" class="hover:text-primary transition font-medium" x-text="t('nav.contact')"></a></li>
        <li><a :href="'terms.html?lang=' + lang" class="hover:text-primary transition font-medium" x-text="t('nav.terms')"></a></li>

        <template x-if="!isLoggedIn">
          <div class="flex items-center gap-4">
            <li><a :href="'register.html?lang=' + lang" class="hover:text-primary transition font-medium" x-text="t('nav.register')"></a></li>
            <li><a :href="'login.html?lang=' + lang" class="bg-primary hover:bg-primary/80 px-4 py-2 rounded-full text-white transition" x-text="t('nav.login')"></a></li>
          </div>
        </template>

        <template x-if="isLoggedIn">
          <li class="flex items-center gap-6">
            <div class="flex items-center gap-3 px-4 py-2 glass rounded-full">
              <div class="w-10 h-10 rounded-full bg-gradient-to-br from-primary to-accent flex items-center justify-center overflow-hidden border-2 border-white/20">
                <template x-if="currentUser?.profilePicture">
                  <img :src="currentUser.profilePicture" alt="Profile" class="w-full h-full object-cover">
                </template>
                <template x-if="!currentUser?.profilePicture">
                  <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                  </svg>
                </template>
              </div>
              <span class="text-sm font-medium text-white" x-text="currentUser?.name || currentUser?.email.split('@')[0]"></span>
            </div>
			<!-- Logout Button -->
			<button @click="handleLogout()" class="bg-red-500 hover:bg-red-600 gap-1 px-4 py-1 rounded-full text-white text-xs font-medium transition" x-text="t('nav.logout')"></button>

            <a :href="'shop.html?lang=' + lang" class="bg-gradient-to-r from-accent to-primary hover:from-primary hover:to-accent px-5 py-2 rounded-full text-white text-sm font-medium transition shadow-lg hover:shadow-primary/30" x-text="t('nav.shop')"></a>
          </li>
        </template>
      </ul>
      <button @click="open = !open" class="md:hidden text-2xl">Menu</button>
    </div>
    <div x-show="open" class="md:hidden glass mx-4 mt-2 rounded-xl shadow-2xl" x-cloak>
      <ul class="py-4 text-right" :class="lang === 'fa' ? 'text-right' : 'text-left'">
        <li><a :href="'index.html?lang=' + lang" class="block px-6 py-3 hover:bg-primary/20" x-text="t('nav.home')"></a></li>
        <li><a :href="'index.html?lang=' + lang + '#products'" class="block px-6 py-3 hover:bg-primary/20" x-text="t('nav.products')"></a></li>
        <li><a :href="'index.html?lang=' + lang + '#about'" class="block px-6 py-3 hover:bg-primary/20" x-text="t('nav.about')"></a></li>
        <li><a :href="'index.html?lang=' + lang + '#contact'" class="block px-6 py-3 hover:bg-primary/20" x-text="t('nav.contact')"></a></li>
        <li><a :href="'terms.html?lang=' + lang" class="block px-6 py-3 hover:bg-primary/20" x-text="t('nav.terms')"></a></li>
        <template x-if="!isLoggedIn">
          <li><a :href="'register.html?lang=' + lang" class="block px-6 py-3 hover:bg-primary/20" x-text="t('nav.register')"></a></li>
          <li><a :href="'login.html?lang=' + lang" class="block px-6 py-3 bg-primary/20" x-text="t('nav.login')"></a></li>
        </template>
        <template x-if="isLoggedIn">
          <li class="px-6 py-4 border-t border-primary/20">
            <div class="flex items-center gap-3 mb-4">
              <div class="w-12 h-12 rounded-full bg-gradient-to-br from-primary to-accent flex items-center justify-center overflow-hidden border-2 border-white/20">
                <template x-if="currentUser?.profilePicture">
                  <img :src="currentUser.profilePicture" alt="Profile" class="w-full h-full object-cover">
                </template>
                <template x-if="!currentUser?.profilePicture">
                  <svg class="w-7 h-7 text-white" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                  </svg>
                </template>
              </div>
              <div class="flex-1">
                <p class="text-white font-medium" x-text="currentUser?.name || currentUser?.email.split('@')[0]"></p>
                <p class="text-gray-400 text-xs" x-text="currentUser?.email"></p>
              </div>
            </div>
            <div class="space-y-2">
              <button @click="handleLogout()" class="w-full text-center py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition" x-text="t('nav.logout')"></button>
            </div>
          </li>
          <li><a :href="'shop.html?lang=' + lang" class="block px-6 py-3 bg-gradient-to-r from-accent to-primary text-white rounded-xl text-center font-medium" x-text="t('nav.shop')"></a></li>
        </template>
      </ul>
    </div>
  </nav>

  <!-- Login Form -->
  <section class="min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-900 via-pink-800 to-red-900 py-20">
    <div class="container mx-auto px-6">
      <div class="max-w-md mx-auto glass p-8 rounded-3xl shadow-2xl">
        <h1 :class="lang === 'fa' ? 'font-faTitle text-3xl fa-title text-center mb-6' : 'text-3xl text-center mb-6 font-bold text-white'"
            x-text="t('login.title')"></h1>
        <form @submit.prevent="handleLogin" class="space-y-4">
          <div>
            <label class="block text-sm font-medium mb-2" x-text="t('login.email')"></label>
            <input type="email" x-model="form.email" required class="w-full p-3 rounded-xl bg-card text-white placeholder-gray-400" :placeholder="t('login.email_placeholder')">
          </div>
          <div>
            <label class="block text-sm font-medium mb-2" x-text="t('login.password')"></label>
            <input type="password" x-model="form.password" required class="w-full p-3 rounded-xl bg-card text-white placeholder-gray-400" :placeholder="t('login.password_placeholder')">
          </div>
          <button type="submit" class="w-full py-3 bg-gradient-to-r from-primary to-accent text-white font-bold rounded-xl hover:scale-105 transition" :disabled="loading">
            <span x-show="!loading" x-text="t('login.button')"></span>
            <span x-show="loading" x-text="t('login.loading')"></span>
          </button>
          <p x-show="message" :class="success ? 'text-green-400' : 'text-red-400'" x-text="message" class="text-center mt-2"></p>
        </form>
        <p class="text-center mt-4 text-gray-400">
          <span x-text="t('login.noAccount')"></span>
          <a :href="'register.html?lang=' + lang" class="text-primary hover:underline" x-text="t('login.registerLink')"></a>
        </p>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="bg-card/50 py-6 sm:py-8 text-sm border-t border-primary/10">
    © 2025 Avarwand. All rights reserved.
  </footer>

</body>
</html>